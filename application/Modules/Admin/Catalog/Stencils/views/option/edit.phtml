<?php
namespace JetShopModule\Admin\Catalog\Stencils;

use Jet\MVC_View;
use Jet\Form;
use Jet\Tr;
use Jet\UI;
use JetShop\Shops;
use JetShop\Stencil;
use JetShop\Stencil_Option;
use JetShop\Stencil_Option_ShopData;

/**
 * @var MVC_View          $this
 * @var Stencil           $stencil
 * @var Stencil_Option    $option
 */
$stencil = $this->getRaw( 'stencil' );
$option = $this->getRaw('option');

$form = $option->getEditForm();

$form->setDefaultLabelWidth( [ Form::LJ_SIZE_MEDIUM => 2 ] );
$form->setDefaultFieldWidth( [ Form::LJ_SIZE_MEDIUM => 4 ] );

$tabs = UI::tabsJS('option_tabs', [
	'tab_main' => Tr::_('Main data'),
	'tab_images' => Tr::_('Images')
]);
?>



<div class="row toolbar" id="main-toolbar">
	<div class="col-md-12">
		<?=UI::button_goBack()->setUrl( $stencil->getEditURL() )?>

		<?php if(!$form->getIsReadonly()): ?>
		<?=UI::button_save()->setOnclick("$('#".$form->getId()."').submit();")?>
		<?php endif; ?>
	</div>
</div>

<div class="row">

	<div class="col-md-12" id="main-col">

		<?=$tabs?>
		<?=$tabs->contentStart()?>
			<?=$tabs->getTab('tab_main')->contentStart()?>
				<?=$form->start()?>

				<?php foreach(Shops::getList() as $shop):
					$shop_key = $shop->getKey();

					$form->field('/shop_data/'.$shop_key.'/filter_label')->input()->addJsAction('onchange', "urlPathPart.afterNameChanged(this.value, '".$form->field('/shop_data/'.$shop_key.'/url_param')->getId()."', '".$shop_key."');");
					$form->field('/shop_data/'.$shop_key.'/filter_label')->input()->addJsAction('onchange', "$('#".$form->field('/shop_data/'.$shop_key.'/product_detail_label')->getId()."').val(this.value);");
					$form->field('/shop_data/'.$shop_key.'/url_param')->input()->addJsAction('onchange', "urlPathPart.afterPathPartChanged(this, '".$shop_key."')");

					$shop_data = $option->getShopData( $shop );
					?>
					<?=$shop_data->renderShopDataBlock_start()?>

					<fieldset>
						<legend class="sub"><?=Tr::_('Main data')?></legend>

						<?=$form->field('/shop_data/'.$shop_key.'/is_active')?>
						<?=$form->field('/shop_data/'.$shop_key.'/filter_label')?>
						<?=$form->field('/shop_data/'.$shop_key.'/product_detail_label')?>
						<?=$form->field('/shop_data/'.$shop_key.'/url_param')?>
						<?=$form->field('/shop_data/'.$shop_key.'/description')?>
					</fieldset>

					<fieldset>
						<legend class="sub"><?=Tr::_('SEO')?></legend>
						<?=$form->field('/shop_data/'.$shop_key.'/internal_fulltext_keywords')?>
					</fieldset>
					<?=$shop_data->renderShopDataBlock_end()?>
				<?php endforeach; ?>
				<?=$form->end()?>
			<?=$tabs->getTab('tab_main')->contentEnd()?>
			<?=$tabs->getTab('tab_images')->contentStart()?>
				<?php
				foreach(Shops::getList() as $shop):
					echo $option->getShopData( $shop )->renderImageWidgets( Stencil_Option_ShopData::getImageClasses(), !$form->getIsReadonly() );
				endforeach;
				?>
			<?=$tabs->getTab('tab_images')->contentEnd()?>
		<?=$tabs->contentEnd()?>



	</div>
</div>

