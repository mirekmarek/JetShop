<?php
namespace JetApplicationModule\Admin\Catalog\Properties;

use Jet\Form;
use Jet\Form_Renderer;
use Jet\Http_Request;
use Jet\Tr;
use Jet\MVC_View;
use Jet\UI;
use JetApplication\Admin_Managers;
use JetApplication\Property_Options_Option;
use JetApplication\Shops_Shop;

/**
 * @var MVC_View   $this
 * @var Form $form
 * @var Property $property
 * @var Property_Options_Option $option
 */
$property = $this->getRaw('property');
$option = $this->getRaw('option');

$form = $option->getEditForm();
$form->renderer()->setDefaultLabelWidth([
	Form_Renderer::LJ_SIZE_MEDIUM => 2
]);

echo $form->start();

?>
	<div class="row toolbar" id="main-toolbar">
		<div class="col-md-12">
			<?=UI::button_goBack()->setUrl(Http_Request::currentURI(set_GET_params: ['page'=>'options'], unset_GET_params: ['option_id']))?>
			
			<?php if( !$form->getIsReadonly() ): ?>
				<?=UI::button_save()?>
			<?php endif; ?>
		</div>
	</div>
	
	<div class="row">
		<div class="col-md-12" id="main-col">
			<?=$this->getRaw('tabs')?>
			<br>
			
			<?=Admin_Managers::UI()->renderEntityActivation( $option, !$form->getIsReadonly() )?>
			<?php
			echo $form->field('internal_name');
			echo $form->field('internal_notes');
			
			if($form->fieldExists('decimal_places')) {
				echo $form->field('decimal_places');
			}
			
			
				
			Admin_Managers::UI()->renderShopDataBlocks(
				form: $form,
				renderer: function( Shops_Shop $shop, string $shop_key ) use ($option, $form) : void {
					$form->field('/shop_data/'.$shop_key.'/filter_label')->input()->addJsAction('onchange', "urlPathPart.afterNameChanged(this.value, '".$form->field('/shop_data/'.$shop_key.'/url_param')->getId()."', '".$shop_key."');");
					$form->field('/shop_data/'.$shop_key.'/filter_label')->input()->addJsAction('onchange', "$('#".$form->field('/shop_data/'.$shop_key.'/product_detail_label')->getId()."').val(this.value);");
					$form->field('/shop_data/'.$shop_key.'/url_param')->input()->addJsAction('onchange', "urlPathPart.afterPathPartChanged(this, '".$shop_key."')");
					?>
					<fieldset>
						<legend class="sub"><?=Tr::_('Main data')?></legend>
						
						<?=Admin_Managers::UI()->renderEntityShopDataActivation( $option, $shop, !$form->getIsReadonly() )?>
						
						<?=$form->field('/shop_data/'.$shop_key.'/filter_label')?>
						<?=$form->field('/shop_data/'.$shop_key.'/product_detail_label')?>
						<?=$form->field('/shop_data/'.$shop_key.'/url_param')?>
						<?=$form->field('/shop_data/'.$shop_key.'/description')?>
					</fieldset>
				<?php }); ?>
		
		</div>
	</div>
	
	<?php
echo $form->end();

